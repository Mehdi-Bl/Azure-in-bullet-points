# Microsoft Entra ID (formerly Azure Active Directory)

## Microsoft Entra ID overview

- **Renamed from Azure Active Directory to Microsoft Entra ID in 2023**
- Underlying service and licensing tiers remain unchanged
- Characteristics
  - Entra ID is cloud-based and geo-distributed
    - Tenant is distributed amongst many servers in Azure
    - Provides high level of availability and scalability
  - Multi-tenant, cloud-based identity service
    - Used by Azure and Microsoft 365
    - Each tenant is segmented off on its own
    - Supports external (B2B) guests
  - Identity & Access
    - Identity/access provider for Microsoft accounts (Office 365, etc.)
    - In-house & third party applications can leverage this service
  - Integrates with on-premises Active Directory
  - Provides SSO for third party or in-house applications
- Global administrator = Root
- Can be managed by Azure Portal, PowerShell/CLI, Microsoft Graph and API

## Licensing Tiers

- **Free**: Basic identity and access management
- **P1** (included with Microsoft 365 Business Premium, etc.):
  - Conditional Access
  - Self-service password reset (SSPR)
  - Group-based licensing
  - Administrative units
  - Advanced security reports
- **P2** (adds to P1):
  - Identity Protection
  - Privileged Identity Management (PIM)
  - Entitlement management
  - Access reviews

[1]: https://docs.microsoft.com/en-us/microsoft-365/enterprise/azure-integration

## Role Based Access Control

- Roles define actions that role is capable of doing
- Roles can be assigned to:
  - Users
  - Groups (preferred for easier management)
  - Service principals
  - Managed identities
- Pre-built administrative roles
- Custom roles can be created for application-specific permissions
- Roles are assigned at tenant level
- If you need separation of roles, create a new tenant with different role assignments

## Custom Domains

- You initially get `tenantname.onmicrosoft.com`
- Custom names must be fully qualified: Not a local name but an online name.
- Ownership must be verified
  - Microsoft gives text records (TXT or MX)
  - You put text record in DNS to get verified
- You can verify multiple domains
- Possible to register subdomains but you register parent domain.
- In Portal: Microsoft Entra ID → Custom domain names → Add custom domain

## Multiple Directories

- **Resource independence**
  - Resource in one directory does not have access to resource in other directory
  - No forests, trusts etc.
- **Administrative independencies**
  - ❗ If you're global admin in one directory doesn't mean you have any access in other directory
- Synchronization independence
  - You can synchronize to specific directory and it does not impact other directories
- Switch directory
  - In Portal → Microsoft Entra ID → Overview → Switch directory

## Conditional Access

- Can be applied on users, locations, devices, applications.
- Policies allow you to have
  - One application with multiple rules
  - One rule with multiple applications
- ❗ Only available in Azure AD Premium
- Condition (if something) → Control (do something)
  - Conditions
    - Users and groups
      - • Groups • User ID • Locations (IP)
    - Cloud apps
    - Device platform and state
      - • Domain Joined • Compliant • Lost or Stolen
    - Locations (IP)
    - Client apps
  - Control: Allow, Deny, MFA
    - Multi-factor authentication
    - Compliant device
    - Approved client app
    - Terms of use
    - Custom and session controls
- Manage in Microsoft Entra ID → Conditional Access
- Example policy: "Marketing app from US only"
  - Assigments
    - **Users and groups**: All users
    - **Cloud apps**: Marketing app (registered in Entra ID)
    - **Conditions**
      - **Locations**: Include any location but exclude *Contoso location*
        - **Contoso locations** is a **named location**
          - Set US locations in portal: Microsoft Entra ID → Conditional Access → Named locations
      - **Client apps**: Apply policy with access from Browser but not from mobile apps and desktop clients.
  - Access controls: Block access

## Access Reviews

- Access review is created for an identified reviewer.
  - Duration can be set
  - Usually created by administrators.
  - Reviewers can approve or deny.
- Access review can be a member of programs.
  - A program groups reviews together.
- Managed in Access Reviews (separate view, not included in Entra ID)

## Administrative Units

- Container of resources
- Used for
  - Delegating administrative permissions over subsets of users
  - Applying policies to a subset of users
- Useful in organizations with independent (autonomous) divisions
- An administrative unit is a directory object that can be created and populated with resources/users.
- Entra ID Premium P1 feature
- E.g. a central administrator can
  - Create an administrative unit for a particular school (Business school)
  - Populate it with only the Business school users
  - Central administrator can add the Business school IT staff to a scoped role
    - Grants the IT staff of Business school administrative permissions only over the Business school administrative unit

## Identity Protection

- Detection
  - Vulnerabilities
    - E.g. MFA not configured, Unmanaged cloud apps, priviliged identity management (only grant identity to user for a set period of time).
  - Risk events (e.g. user signin in from unknown detection)
    - E.g. leaked credentials on internet, anonymous IP addresses (VPNs etc.), suspicious IP addresses, impossible travel (superman event, user logs in from NY and after 5 minutes logs in from Hong Kong), Unknown locations, Infected devices.
- Investigations
  - Recieve notifications
  - Workflows *(when, who, what happened)*
  - Analysis: How can you apply policies to prevent such future events?
- Policies
  - *User risk policy*: E.g. if user risk event is high, allow access but require password change
  - *Sign-in risk*: E.g. if sign-in risk is medium, allow access but require MFA.

## Auditing and Monitoring

- Microsoft Entra ID → Activity
  - Sign-in: See, filter, search log-on statuses
  - Audit logs: See, filter, search activity logs for Entra ID
- Microsoft Entra ID → Users and groups
  - You can see user sign-in risks
- Microsoft Entra ID → Azure AD Connect
  - Install Azure AD Connect health from here
  - Shows health of your Entra ID connections

## Groups

- Groups can be:
  - **Security groups**: For managing access to resources and grouping users
  - **Microsoft 365 groups**: For collaboration (email, files, etc.)
- Membership types:
  - **Static**: Manually assigned members
  - **Dynamic**: Membership based on user attributes (e.g., Department = "Sales")
    - Requires Entra ID P1 or P2
  - **Dynamic Device**: Membership based on device attributes
- Owners can manage group membership if allowed
- Group-based licensing: Assign licenses to a group, members inherit automatically

## External Identities

- **B2B collaboration**: Invite guest users from other organizations
  - Guest accounts maintain their identity in their home directory
  - Access is granted through the inviting organization
- **Entra External ID**: Direct federation with external identity providers
- **Self-service sign-up**: Users can sign up with identity providers like Google or Facebook (for some services)
- Allows collaboration without requiring external users to have accounts in your tenant

## Passwordless Authentication (Recommended)

- Microsoft recommends passwordless methods for improved security:
  - **FIDO2 security keys**: Hardware-based authentication
  - **Windows Hello for Business**: Biometric authentication
  - **Microsoft Authenticator app**: Push notifications or OTP
- These methods eliminate passwords and provide stronger security
- Can be configured through Conditional Access policies
