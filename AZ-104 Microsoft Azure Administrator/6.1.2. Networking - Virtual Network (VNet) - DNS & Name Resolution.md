# DNS & Name Resolution

## Azure-provided name resolution

- No configuration required
- All VMs within a VNet can resolve each other's host names
- ❗ Limitations
  - Cross-VNet name resolution
  - No custom DNS suffix
- You can add custom DNS server IP addresses
  - E.g. in hybrid cloud if you want Azure VMs to have IP addresses from on-premises DNS server or vice versa
  - E.g. stand up own DNS servers in VNet instead
  - E.g. configure DNS forwarding between one DNS server in one VNet to another DNS server in another VNet

## Azure DNS Private Resolver - **NEW 2025**

- Fully managed, highly available DNS service
- Enables DNS resolution between Azure VNets and on-premises networks **without deploying custom DNS servers**
- Components:
  - **Inbound endpoints**: For on-premises clients to resolve Azure private DNS zones
  - **Outbound endpoints**: Send DNS queries to on-premises or external DNS servers
  - **Conditional forwarding rules**: Forward DNS queries to specific servers based on domain suffixes
- Benefits:
  - **Built-in high availability** - no need for custom DNS server clusters
  - **Cost reduction** - pay only for what you use
  - **Scalable performance** - automatically scales based on query load
  - **Integration** - ARM/Bicep/Terraform support
- Use cases:
  - Hybrid DNS resolution between Azure and on-premises
  - Centralized DNS management across multiple VNets
  - Replacement for custom DNS server deployments

## Azure DNS

- Allows VNETs to resolve each others host names.
- **Host your public DNS domain in Azure**
  - Use Azure geo-distributed name servers for high speed name resolution
  - Delegate a domain:
    1. Create a DNS Zone
    2. Copy an Azure DNS name server from the zone
    3. In the registrar's DNS management page, edit the NS records and replace the NS records with the Azure DNS name servers.
- You manage in Portal -> DNS zone
  - Each DNS zone has
    - VNets of associated with it
    - **Record-sets**: IP addresses and host names of VMs
- **Create private DNS zones**
  - Allows you to not route names in public DNS
  - **Linked to VNets**
    - Lets you avoid setting up own DNS infrastructure
  - **Registration VNet**
    - You create private DNS zone and registration VNet
    - Any VMs within that VNet will automatically have their names registered and DNS records created in Azure DNS
  - **Resolution VNet**
    - Allows you to have name resolution across VNets
    - Other VNets will be resolution VNets
    - Allows you to create records (hosts, alias) for VMs and it'll support name resolution across VNets

## Hybrid Cloud

- ❗ Azure provided DNS won't work with peering
- **Traditional solution**:
  - On-premises: Configure own DNS server and forward queries to Azure
  - In Azure:
    - Connect VNets (peer or VPN)
    - Deploy own DNS servers in VNets and configure forwarding there
  - ❗ Too much overhead
- **Recommended solution**: Use **Azure DNS Private Resolver** or **Azure DNS Private Zones**
  - Azure DNS Private Resolver: Fully managed, no custom DNS servers needed
  - Azure DNS Private Zones: Configure Azure DNS servers specifically for private zones
  - One network: **Registration network**
    - Hosts will have their names auto-registered in private zones
  - Other networks: **Resolution networks**
    - You need to manually create hosts in CNAME/MX records

## Name Resolution Across Peered VNets

- Default name resolution in VNets can be extended across **peered VNets** and **hybrid networks**
- Use Azure DNS Private Resolver for:
  - Automatic cross-VNet name resolution
  - On-premises DNS integration
  - Centralized DNS management
- Configure using:
  - Virtual network peering with DNS resolution
  - Private DNS zones linked to multiple VNets
  - DNS Private Resolver with conditional forwarding
