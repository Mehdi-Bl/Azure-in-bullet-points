# Roles

## Role assignments

- Delegated resource administration
- Roles organize related resource permissions together
  - Depends on resource type
    - E.g. different for VM and storage.
- **Scope hierarchy** (permissions inherit downward)
  - Management groups â†’ Subscription â†’ Resource groups â†’ Individual resources
  - Permissions assigned at a higher scope are inherited downwards
- **Modern practice**: Assign roles to Azure AD groups or managed identities rather than directly to users
- **Managed identities** (preferred for applications)
  - System-assigned: Tied to an Azure service instance
  - User-assigned: Standalone resource that can be assigned to multiple resources

## Azure AD Privileged Identity Management (PIM)

- Allows just-in-time assignment for high-privilege roles
- Supports approval workflows for sensitive roles
- Provides time-bound access and requires MFA for role activation
- Useful for reducing standing privileges and improving security posture
- Role can be assigned to:
  - Users
  - Groups
  - Service principal
    - Application
    - System Assigned Managed Identity: App Service, Function App, Virtual Machine, Virtual Machine Scale Set
    - User Assigned Managed Identity

## Role types

### Built-in roles

- **100+ built-in roles** (updated from 60+)
- Defined at the Azure Resource Manager level
- Common roles:
  - **Owner**: Manage resources and resource access
  - **Contributor**: Manage resources but not resource access
  - **Reader**: Read-only access
  - **User Access Administrator**: Manage user access to resources
  - **Storage Blob Data Reader**: Data-plane role for reading storage blobs
  - **SQL DB Contributor**: Manage, but not access, SQL databases
  - **VM Contributor**: Manage, but not access, virtual machines
- Data-plane roles (for specific data access):
  - Storage Blob Data roles (Reader, Contributor, Owner)
  - Storage Queue Data roles
  - Storage File Data roles
  - Table Data roles

### Custom roles

- Can be created via: Portal, Azure CLI, Azure PowerShell, or ARM/Bicep templates
  - `New-AzRoleDefinition -Role $customRole`
- Shows in same drop-down lists with built-in roles
- JSON definition example:

  ```json
    {
      "Name": "Network Resource Viewer",
      "IsCustom": true,
      "Description": "Allows reading Azure network resources.",
      "Actions": [ "Microsoft.Network/*/read" ],
      "NotActions": [ ],
      "AssignableScopes": [ "/subscriptions/048.." ]
    }
    ```
- Best practices:
  - Start with built-in roles when possible
  - Use least-privilege principle
  - Define clear assignable scopes
  - Document the role's purpose and permissions

## Classic Administrator Roles

- The account that is used to sign up for Azure is automatically set as both the *Account Administrator* and *Service Administrator*.
  - Roles are properties that can be changed in Subcription blade
- ðŸ’¡ Azure recommends using RBAC roles
- **Account Administrator** (1 per Azure account)
  - Conceptually, the billing owner of the subscription.
  - The Account Administrator has no access to the Azure portal.
- **Service Administrator** (1 per Azure subscription)
  - By default, for a new subscription, the Account Administrator is also the Service Administrator.
  - The Service Administrator has the equivalent access of a user who is assigned the Owner role at the subscription scope.
  - The Service Administrator has full access to the Azure portal.
- **Co-Administrator** (200 per subscription)
  - The Co-Administrator has the equivalent access of a user who is assigned the Owner role at the subscription scope.
