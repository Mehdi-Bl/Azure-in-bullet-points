# Source code version control

## Introduction

- Helps developers create & maintain versions for their source code.
- Developers can collaborate on code & track changes
- Required for any development project.
- `git` is most commonly used.
- Azure DevOps has Azure Repos that support `git` and Team Foundation Version Control.
- Flow
  - Each developer has their own copy
  - They make changes
  - Push their changes into central repository
  - Other developers pull changes into their repositories

### Trunk-Based Development (2025 Best Practice)

- **Modern Branching Strategy**: Each developer commits to main/trunk daily
- **Short-Lived Branches**: Features merged within 1-2 days maximum
- **Continuous Integration**: Enables fast feedback loops
- **Reduced Complexity**: Eliminates long-running feature branches
- **GitHub Flow**: Popular implementation for cloud-native applications
  - Create feature branch from main
  - Make commits with clear messages
  - Open pull request for review
  - Merge to main after approval
  - Deploy immediately to production

### Conflicts

- If developer makes changes to same line of code it results in conflict.
- Other developers must resolve the conflict.
- **Locking Solutions (2025)**:
  - **Git LFS File Locking**: Lock binary files to prevent conflicts
    - Supported by GitHub, Azure Repos
    - Ideal for large binary assets (images, videos, models)
  - **GitHub Codespaces**: Cloud-based development environment for consistency
    - Pre-configured dev containers
    - Reduces environment-related conflicts
  - Centralized solutions such as SVN & ClearCase also support locking

## Repository Scaling - **ENHANCED 2025**

### Large File Support

- **Git Large File Storage (LFS)**:
  - Replaces large files with text pointers
  - Stores binary files in remote LFS server
  - Reduces repository size and clone time
  - Essential for repositories with large assets

- **Scalar**: Virtual filesystem for Git repositories
  - Improves performance on large repositories
  - Background maintenance and prefetching
  - Designed for enterprise-scale repositories

- **GVFS (Git Virtual File System)**: Windows-only solution
  - Virtualizes file system to improve performance
  - Used by Microsoft for Windows development

### Partial Clone and Sparse Checkout

- **Partial Clone**: Download only necessary objects initially
- **Sparse Checkout**: Checkout only specific directories
- **Benefits**: Faster initial clone, reduced storage requirements

## Centralized vs Decentralized repositories

- In a centralized repository like `SVN` everyone commits to a single repository.
  - If you lose server without backups, then everything is gone
- In a decentralized repository like `git` everyone commits to their own local copy (repository) of the remote repository and then pushes their changes to the remote repository.
  - You can work offline, as you don't need network to e.g. diff, check history, commit ,merge, switching branches, obtaining other revisions of a file

## Version Control Systems

| name | type | license | description | Azure Repos support | Terminology |
| ---- | --- | ------- | ------------ | :------------------: | -- |
| **git** | distributed | open-source | most popular, a lot tooling | âœ”ï¸ | pull & push |
| **TFVC** | centralized | proprietary | branches = paths, granular permissions down to a file level | âœ”ï¸ | check-in & check-out |
| **mercurial** | distributed | open-source | used by .eg. Facebook & Mozilla, simpler than GIT | âŒ | pull & push |
| **svn** (apache subversion) | centralized | open-source | branches = paths, granular permissions down to a file level | âŒ | commit & update |
| **Helix Core** (Perforce) | centralized | proprietary | branches = paths, granular permissions down to a file level | âŒ | check-in & check-out |
| **ClearCase** | centralized | proprietary | file-based architecture (where everything happens e.g. tagging at the file level) | âŒ |

## Central source code repository

- Git is distributed where each developer has own copy of the repository
  - so who has the master?
- Many teams uses centralized Git model
  - Possible to setup a Git server to host the repositories, but then maintenance is needed
  - or there are e.g. GitHub, Atlassian, Azure Repos on internet.

### Team Foundation Version Control

- ðŸ’¡ In Azure DevOps: Choose TFVC for granular permissions on branch (=path) level, otherwise use GIT.
- [Types](https://docs.microsoft.com/en-us/azure/devops/repos/tfvc/branching-strategies-with-tfvc?view=azure-devops#main-only)
  - **Main Only** - commit your changes to the main branch and optionally indicate development and release milestones with tags
    - ![Main Only strategy](./img/branching-tfvc/main-only.png)
    - â— The mutability and lack of history with TFVC labels can add risk of change control.
  - **Development isolation**
    - Have stable **main** branch, you can branch one or more **dev** branches from **main**
    - Enables isolation and concurrent development
    - ![Development isolation](./img/branching-tfvc/development-isolation.png)
  - **Feature isolation**
    - Special derivation of the development isolation
    - Branch one or more feature branches from **main**, as shown, or from your **dev** branches
    - ![Feature isolation](./img/branching-tfvc/feature-isolation.png)
  - **Release isolation**
    - Introduces one or more **release** branches from **main**
      - Never forward integrate (FI) from **main**.
      - Patches and hot fixes made to the **release** can be reverse integrated (RI) back to the **main**.
    - ![Release isolation](./img/branching-tfvc/release-isolation.png)
  - **Servicing and Release isolation**
    - Allows e.g. service packs
    - release branch should never be modified
    - Never forward integrate from **main** to **servicing**, and **servicing** to **release**.
    - Altough not recommended, you can continue to evolve by introducing e.g. **hotfix** branches to releases=> **Servicing, Hotfix, Release isolation**
    - ![Release isolation](./img/branching-tfvc/service-release-isolation.png)
