# SQL (Azure SQL Database) - 2025

## Azure SQL Database (2025) - Managed Database Platform

### Overview
- Fully managed PaaS database service built on SQL Server engine
- Automatic updates, backups, and patches
- High compatibility with SQL Server on-premises
- Supports both DTU and vCore purchasing models

### 2025 Deployment Models

#### Single Database
- **Isolation**: Fully isolated database
- **Compute**: Serverless or provisioned compute options
- **Storage**: Independent scaling of compute and storage
- **Use Cases**: Modern applications, microservices, single-tenant databases

#### Elastic Pool (Enhanced 2025)
- **Resource Sharing**: Share compute resources across databases
- **Cost Optimization**: Pay for pooled compute resources
- **Dynamic Scaling**: Scale resources based on demand
- **Use Cases**: Multi-tenant applications, variable workloads, SaaS applications
- **Benefits**:
  - Centralized management
  - Cost-effective for many databases
  - Automatic scaling

#### Hyperscale (2025)
- **Storage**: Up to 100 TB per database
- **Compute**: Scale up to 100 vCores per compute replica
- **Performance**: Read replicas and fast backup restore
- **Use Cases**: Large databases, high throughput applications

### 2025 Compute Options

#### Serverless (2025)
- **Auto-Pause**: Automatically pause during inactivity (1-7 days configurable)
- **Auto-Scale**: Scale compute based on demand
- **Billing**: Pay per second of compute used
- **Best For**: Intermittent, unpredictable workloads, development/test
- **Cold Start**: Configurable to maintain warm state
- **vCore Range**: 0.5 - 80 vCores

#### Provisioned
- **Fixed Resources**: Dedicated compute resources
- **Predictable Performance**: Consistent performance
- **No Auto-Pause**: Always available
- **Best For**: Steady-state workloads, performance-critical applications
- **Reserved Capacity**: Save up to 72% with reserved capacity

### 2025 Service Tiers

#### General Purpose
- **Storage**: Remote storage (100 GB - 4 TB)
- **Compute**: Balanced CPU and memory
- **Use Cases**: Most business applications, web applications

#### Business Critical
- **Storage**: Local SSD storage
- **Compute**: High CPU and memory
- **High Availability**: Built-in Always On availability groups
- **Use Cases**: Mission-critical applications, ERP, CRM

#### Hyperscale
- **Storage**: Up to 100 TB
- **Compute**: Scale compute independently
- **Performance**: Fast backup/restore, read scale-out
- **Use Cases**: Large-scale applications, data warehousing

### Azure Database for MySQL (2025)

- **Open Source**: Community MySQL
- **Tools**: Pre-installed tools like mysql.exe and phpMyAdmin
- **Deployment Models**: Single Server, Flexible Server
- **High Availability**: Built-in HA with zone redundancy
- **Security**: Encryption at rest and in transit
- **Backup**: Automated backups with point-in-time restore
- **Scaling**: Scale compute and storage independently

### Azure Database for PostgreSQL (2025)

- **Open Source**: Community PostgreSQL
- **Deployment Models**: Single Server, Flexible Server, Hyperscale (Citus)
- **High Availability**: Built-in HA, read replicas
- **Advanced Features**:
  - Logical replication
  - Partitioning
  - Extensions support
- **Security**: Encryption at rest and in transit
- **Flexible Server**: Enhanced HA, customizable maintenance windows

## Azure SQL Database

- Database as a service
- Predictable performance
  - Through comparison of DTUs (Database Throughput Units)
  - DTUs describe capacity of tier and performance level
  - Relative: E.g. Basic (B) 5, Standard (S2) 50, so standard is 10 times power of Basic
- High compatibility
  - A tabular data Stream (TDS) endpoint is provided for each logical server
- Management
  - In portal: Azure Management Portal -> Manage
  - REST API, PowerShell or Xplat CLI
- **Retention**
  - **Long-term retention (LTR)**: Automatically retain backups in Azure Blob storage for up to 10 years
  - **Azure SQL Database automatic backups**: 7-35 days

### Database Tiers

- Three tier where every tier have different performance levels:

  | Tier | DTU | Ideal for |
  | ---- | --- | --------- |
  | **Basic** | 5 | small dbs, single active operation, dev/test, small scale apps |
  | **Standard** | 10 - 100 | multiple operations, workgroup or web apps |
  | **Premium** | 100 - 800 | high transaction volumes, large number of users, multiple operations, mission critical apps |

- Basic/Standard model
  - Based on remote storage.
  - Uses Azure Premium Storage Disks, i.e. accessed over network.
- Premium/Business Critical model
  - Uses AlwaysOn Availability Groups
  - Has local attached SSD storage
    - Provides higher IOPS and throughput

### Elastic Scale

- Scaling it/out by simplified sharding.
  - Coordinates data movement between shards to split or merge ranges of data among different databases
- Satisfies common scenarios such as pulling a busy tenant into its own shardING
- Split-Merge service
  - Provided through a downloadable package
  - Customers can deploy as an Azure cloud service into their own subscription.
  - Two main parts:
    - An **Elastic Scale library (SDK)** for client applications to configure shards and access shards.
      - Direct transactions to the appropriate shard
      - Perform queries across multiple shards
      - Modify service tier for existing shards
    - The Elastic Scale features in Azure SQL Database that implements the any changes requested by your application.

## Availability

- **Azure Site Recovery**: Only for VMs

## AlwaysOn

- Available only in SQL servers
- Azure SQL database implements it in its underlying infrastructure for Premium tier to achieve high availability but abstracts it away using [active geo-replication](#active-geo-replication)
- **AlwaysOn availability groups**
  - An availability group supports a failover environment for a discrete set of user databases, known as availability databases, that fail over together.
- **Always On Failover Cluster Instances**
  - Leverages *Windows Server Failover Clustering (WSFC)* functionality
  - Provides local high availability through redundancy at the server-instance level failover cluster instance (FCI).
  - **FCI (failover cluster instance)**
    - Single instance of SQL Server that is installed across Windows Server Failover Clustering (WSFC) nodes and, possibly, across multiple subnets

## Active geo-replication

- Leverages the Always On technology of SQL Server.
- Azure SQL Database feature.
  - Supported in Elastic Pools.
  - ‚ùó Not supported in managed instances.
  - üí° Use auto-failover groups for them.
    - It also supports SQL database.
- Multiple secondaries are supported as opposed to auto-failover groups.
- Allows you to create readable secondary databases of individual databases on a SQL Database server in the same or different data center (region).
- Best practice configuration:
  - User => Azure Traffic Manager =>
    1. Ingress LB => SQL in Primary Logical Server
    2. Ingress LB => SQL in Secondary Logical Server
  - Capabilities:
    - Automatic Asynchronous Replication
    - Readable secondary databases
    - Planned / Unplanned failover
    - Multiple readable secondaries
    - Geo-replication of databases in an elastic pool
      - Each secondary database can separately participate in an elastic pool or not be in any elastic pool at all.
    - Configurable compute size of the secondary database
    - User-controlled failover and failback
    - Keeping credentials and firewall rules in sync

## Auto-failover group

- Allows you manage replication and failover of a group of
  - databases on a SQL Database server
  - or all databases in a Managed Instance to another region
- It uses the same underlying technology as active geo-replication.
- You can failover
  1. Manually
  2. Alternatively  you can delegate it to the SQL Database service based on a user-defined policy.
- When working with single or pooled databases on a SQL Database server and you want multiple secondaries in the same or different regions, use active geo-replication.
- You get URL (HA URL) for the DB.
- Terminology and capabilities
  - **Failover group**
    - Group of databases that can either be:
      - SQL Database servers
      - Managed Instances
  - **Primary & secondary hosts**
    - Use Active-geo replication for multiple secondary hosts.
  - **Adding databases in elastic pool to failover group**
    - *Multiple failover groups*: You can configure multiple failover groups for the same pair of servers to control the scale of failovers. Each group fails over independently
      - ‚ùó Managed Instance does not support multiple failover groups
  - **Grace period with data loss**: By configuring `GracePeriodWithDataLossHours`, you can control how long the system waits before initiating the failover that is likely to result data loss.

## Failover strategies

- **Automatic failover policy**: Configured by default
- **Read-only failover policy**:
  - Kicks in after a set period (hours) so that data is not last during a long failure.
  - Disabled by default
  - When disabled:
    - Performance of the primary is not impacted when the secondary is offline.
    - Read-only sessions will not be able to connect until the secondary is recovered
  - When enabled
    - Read-only traffic will be automatically redirected to the primary if the secondary is not available.
    - Performance gets lower in the primary
  - Use if you
    - cannot tolerate downtime for the read-only sessions.
    - are OK to temporarily use the primary for both read-only and read-write traffic at the expense of the potential performance degradation of the primary
- **Planned failover**: Full synchronization without data loss
  - Use-cases:
    - Perform disaster recovery (DR) drills in production when the data loss is not acceptable
    - Relocate the databases to a different region
    - Return the databases to the primary region after the outage has been mitigated (failback).
- **Unplanned failover**: Switches directly without any synchronization.
- **Manual failover**: You can initiate forced or friendly failover (with full data synchronization).
